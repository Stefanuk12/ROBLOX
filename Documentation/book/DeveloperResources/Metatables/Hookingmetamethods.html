<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Hooking metamethods - Documentation</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="../../fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../../info.html">Infomation</a></li><li class="chapter-item expanded "><a href="../../Scripts/Games/main.html"><strong aria-hidden="true">1.</strong> Games</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../Scripts/Games/KohlsAdminHouse/main.html"><strong aria-hidden="true">1.1.</strong> Kohls Admin House</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../Scripts/Games/KohlsAdminHouse/oofkohlsv2/oofkohlsv2.html"><strong aria-hidden="true">1.1.1.</strong> oofkohls v2</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../Scripts/Games/KohlsAdminHouse/oofkohlsv2/Admin.html"><strong aria-hidden="true">1.1.1.1.</strong> Admin</a></li><li class="chapter-item expanded "><a href="../../Scripts/Games/KohlsAdminHouse/oofkohlsv2/ServerOOF.html"><strong aria-hidden="true">1.1.1.2.</strong> Server OOF</a></li><li class="chapter-item expanded "><a href="../../Scripts/Games/KohlsAdminHouse/oofkohlsv2/SoundAbuse.html"><strong aria-hidden="true">1.1.1.3.</strong> Sound Abuse</a></li><li class="chapter-item expanded "><a href="../../Scripts/Games/KohlsAdminHouse/oofkohlsv2/MusicCommands.html"><strong aria-hidden="true">1.1.1.4.</strong> Music Commands</a></li><li class="chapter-item expanded "><a href="../../Scripts/Games/KohlsAdminHouse/oofkohlsv2/GearGiver.html"><strong aria-hidden="true">1.1.1.5.</strong> Gear Giver</a></li><li class="chapter-item expanded "><a href="../../Scripts/Games/KohlsAdminHouse/oofkohlsv2/Anti.html"><strong aria-hidden="true">1.1.1.6.</strong> Anti</a></li><li class="chapter-item expanded "><a href="../../Scripts/Games/KohlsAdminHouse/oofkohlsv2/Control.html"><strong aria-hidden="true">1.1.1.7.</strong> Control</a></li><li class="chapter-item expanded "><a href="../../Scripts/Games/KohlsAdminHouse/oofkohlsv2/Misc.html"><strong aria-hidden="true">1.1.1.8.</strong> Misc</a></li></ol></li><li class="chapter-item expanded "><a href="../../Scripts/Games/KohlsAdminHouse/AudioVisualiser/AudioVisualiser.html"><strong aria-hidden="true">1.1.2.</strong> Audio Visualiser</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../Scripts/Games/KohlsAdminHouse/AudioVisualiser/Orbiter.html"><strong aria-hidden="true">1.1.2.1.</strong> Orbiter</a></li><li class="chapter-item expanded "><a href="../../Scripts/Games/KohlsAdminHouse/AudioVisualiser/OrbiterSettings.html"><strong aria-hidden="true">1.1.2.2.</strong> Orbiter Settings</a></li><li class="chapter-item expanded "><a href="../../Scripts/Games/KohlsAdminHouse/AudioVisualiser/Toggles.html"><strong aria-hidden="true">1.1.2.3.</strong> Toggles</a></li><li class="chapter-item expanded "><a href="../../Scripts/Games/KohlsAdminHouse/AudioVisualiser/Misc.html"><strong aria-hidden="true">1.1.2.4.</strong> Misc</a></li></ol></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../../Scripts/Other/main.html"><strong aria-hidden="true">2.</strong> Other</a></li><li class="chapter-item expanded "><a href="../../Scripts/Universal/main.html"><strong aria-hidden="true">3.</strong> Universal</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../Scripts/Universal/MusicAPI/main.html"><strong aria-hidden="true">3.1.</strong> Music API</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../Scripts/Universal/MusicAPI/Variables.html"><strong aria-hidden="true">3.1.1.</strong> Variables</a></li><li class="chapter-item expanded "><a href="../../Scripts/Universal/MusicAPI/Functions.html"><strong aria-hidden="true">3.1.2.</strong> Functions</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../../DeveloperResources/main.html"><strong aria-hidden="true">4.</strong> Developer Resources</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../DeveloperResources/Metatables/main.html"><strong aria-hidden="true">4.1.</strong> Metatables</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../DeveloperResources/Metatables/Hookingmetamethods.html" class="active"><strong aria-hidden="true">4.1.1.</strong> Hooking metamethods</a></li></ol></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Documentation</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#hooking-metamethods" id="hooking-metamethods">Hooking metamethods</a></h1>
<p>Previously, we discussed metatables and metamethods in normal vanilla lua but how about ROBLOX lua? Well in ROBLOX Lua there's a very interesting metamethod called __namecall. __namecall is fired when you use &quot;<em>:</em>&quot; on something. For example:</p>
<pre><code class="language-lua">RemoteEvent:FireServer() -- Example 1
workspace:GetChildren() -- Example 2
</code></pre>
<p>Uniquely, there's no &quot;set&quot; amount of arguments but there are two main ones. Within a namecall hook, you can get the first argument which is the thing __namecall is being called on. In our example, that would be <code>RemoteEvent</code> and <code>workspace</code> and then a 'hidden' one called the method. In our example, that would be <code>FireServer</code> and <code>GetChildren</code>. In normal roblox lua, you cannot simply just get it like that but you need to use a custom function like <code>getnamecallmethod()</code>. </p>
<h4><a class="header" href="#what-can-we-do-with-this" id="what-can-we-do-with-this">What can we do with this?</a></h4>
<p>Anything that uses remotes or namecall on the client can be easily exploited, if a game uses a Kick remote, you can simply block the remote and you will not get kicked or if you want to edit certain arguments like the damage amount you do, you can do that with __namecall. You can also use it to make remote spies and edit the return value of <code>InvokeServer</code>. It's amazing what you can do with it.</p>
<h4><a class="header" href="#how-to-hook-metamethods" id="how-to-hook-metamethods">How to hook metamethods</a></h4>
<p>Firstly, we want to get the main game metatable. So we can do it by doing:</p>
<pre><code class="language-lua">local mt = getmetatable(game)
</code></pre>
<p>While that may work, that is not how it should be done! The main game metatable has a metamethod that locks it called <code>__metatable</code>. This means we can't do anything with it and it &quot;hides&quot; the metatable. Instead we need to use <code>getrawmetatable</code></p>
<pre><code class="language-lua">local mt = getrawmetatable(game)
</code></pre>
<p>Now we need to backup the metamethod we are changing to return it in the end or else anything that uses that metamethod, will break:</p>
<pre><code class="language-lua">local mt = getrawmetatable(game)
local backupnamecall = mt.__namecall
</code></pre>
<p>Now lets change it! No, we cannot do that! The metatable is also locked, we need to unlock it. We can do this by using the function <code>setreadonly</code>.</p>
<pre><code class="language-lua">local mt = getrawmetatable(game)
local backupnamecall = mt.__namecall
setreadonly(mt, false)
</code></pre>
<p>Now we can change it, firstly, lets set some base variables inside the hook and return the backup.</p>
<pre><code class="language-lua">local mt = getrawmetatable(game)
local backupnamecall = mt.__namecall
setreadonly(mt, false)

mt.__namecall = newcclosure(function(...)
    local args = {...}
    local method = getnamecallmethod()

    return backupnamecall(...)
end)
</code></pre>
<p>I've done a lot of things that you may not recognise. Firstly, I've used the function <code>newcclosure</code>. This function makes the command inside a C Function, no need to worry about what that exactly means but it means we can avoid detection levels of the hook being applied. Usually that could be detected by doing this:</p>
<pre><code class="language-lua">local Env = getfenv()

xpcall(function()
    return game:_____()
end, function()
    for i = 0, 10 do
        if getfenv(i) ~= Env then
            warn(&quot;Detected metamethod tampering!&quot;)
        end
    end
end)
</code></pre>
<p>or</p>
<pre><code class="language-lua">local OldErr, OldMsg = pcall(function() return game:____() end)

while wait(1) do
    local Err, Msg = pcall(function() return game:____() end)

    if OldErr ~= Err or OldMsg ~= Msg then
        warn(&quot;Detected metamethod tampering!&quot;)
    end
end
</code></pre>
<p>Back to our code, now lets make it print all of the things that use __namecall. Note: <code>checkcaller</code> checks if the script was executed by the executor or not.</p>
<pre><code class="language-lua">local mt = getrawmetatable(game)
local backupnamecall = mt.__namecall
setreadonly(mt, false)

mt.__namecall = newcclosure(function(...)
    local args = {...}
    local method = getnamecallmethod()
    print('__namecall fired! Self - '..args[1]:GetFullName()..' Checkcaller - '..checkcaller()..' Args:')
    table.foreach(args, print)
    return backupnamecall(...)
end)
</code></pre>
<p>Now I will show you an anti-kick I made using <code>hookfunction</code> and mainly, <code>__namecall hooking</code>:</p>
<pre><code class="language-lua">-- // Vars
local LocalPlayer = game:GetService(&quot;Players&quot;).LocalPlayer

-- // Base MT Vars + Funs
local mt = getrawmetatable(game)
local backupnamecall = mt.__namecall
setreadonly(mt, false)

-- // Anti kick
hookfunction(LocalPlayer.Kick, warn)
hookfunction(LocalPlayer.kick, warn)

mt.__namecall = newcclosure(function(...)
    if string.lower(getnamecallmethod()) == &quot;kick&quot; then return end
    return backupnamecall(...)
end)
</code></pre>
<p>That's the end of what I have to explain, for more examples, please visit the Synapse X Guide listed at the top!</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../../DeveloperResources/Metatables/main.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../../DeveloperResources/Metatables/main.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
